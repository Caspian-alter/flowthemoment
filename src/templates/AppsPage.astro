---
import BaseLayout from '../layouts/BaseLayout.astro';
import FlowMotif from '../components/FlowMotif.astro';
import { getCopy } from '../i18n/copy';
import { withBase, type Locale } from '../i18n/utils';
import { getAppLegalLinks } from '../i18n/app-legal';
import { getProfilePath } from '../i18n/app-profiles';

interface Props {
  locale: Locale;
  path: string;
}

const { locale, path } = Astro.props;
const t = getCopy(locale);
const motifs: Array<'wave' | 'rings' | 'breathe'> = ['breathe', 'wave', 'rings', 'wave'];
---

<BaseLayout title={`${t.appsPage.title} | Flow the Moment`} description={t.appsPage.intro} locale={locale} path={path}>
  <section class="shell page-hero">
    <p class="eyebrow">Flow the Moment</p>
    <h1>{t.appsPage.title}</h1>
    <p class="lead">{t.appsPage.intro}</p>
  </section>

  <section class="shell" aria-labelledby="apps-section-title">
    <div class="section-intro">
      <h2 id="apps-section-title">{t.appsPage.sectionTitle}</h2>
    </div>
    <div class="stack-grid">
      {t.apps.items.map((app, index) => {
        const legalLinks = getAppLegalLinks(locale, app.id);
        const profilePath = getProfilePath(locale, app.id);
        return (
          <article class="card app-detail" id={app.id}>
            <div>
              <p class="eyebrow">{app.nameEn}</p>
              <h3>{app.name}</h3>
              <p class="lead-sm">{app.oneLine}</p>
              <p>{app.detail}</p>
              <ul>
                {app.bullets.slice(0, 3).map((item) => <li>{item}</li>)}
              </ul>
              {profilePath && (
                <div class="legal-links">
                  <p class="legal-links-title">{locale === 'zh' ? '应用详情页' : 'Product Page'}</p>
                  <a class="text-link" href={withBase(profilePath)}>
                    {locale === 'zh' ? '查看产品介绍' : 'View product story'}
                  </a>
                </div>
              )}
              {legalLinks && (
                <div class="legal-links">
                  <p class="legal-links-title">{locale === 'zh' ? '法律文档' : 'Legal Documents'}</p>
                  <a class="text-link" href={withBase(legalLinks.privacyPath)}>
                    {legalLinks.privacyLabel}
                  </a>
                  <a class="text-link" href={withBase(legalLinks.termsPath)}>
                    {legalLinks.termsLabel}
                  </a>
                </div>
              )}
            </div>
            <FlowMotif kind={motifs[index] ?? 'wave'} />
          </article>
        );
      })}
    </div>
  </section>

  <section class="shell faq" aria-labelledby="faq-title">
    <div class="section-intro">
      <h2 id="faq-title">{t.appsPage.faqTitle}</h2>
    </div>
    <div class="faq-list">
      {t.appsPage.faqs.map((item) => (
        <details class="card">
          <summary>{item.q}</summary>
          <p>{item.a}</p>
        </details>
      ))}
    </div>
  </section>
</BaseLayout>
