---
import { getCopy } from '../i18n/copy';
import type { Locale } from '../i18n/utils';

interface Props {
  locale: Locale;
}

const { locale } = Astro.props;
const t = getCopy(locale);
const subject =
  locale === 'zh'
    ? 'Flow the Moment 订阅更新'
    : 'Flow the Moment waitlist update';
---

<section class="waitlist card" aria-labelledby="waitlist-title">
  <h2 id="waitlist-title">{t.waitlist.title}</h2>
  <p>{t.waitlist.body}</p>

  <form
    class="waitlist-form"
    data-waitlist-form
    action="mailto:hello@flowthemoment.com"
    method="post"
    enctype="text/plain"
  >
    <label for="waitlist-email" class="sr-only">{t.common.emailLabel}</label>
    <input
      id="waitlist-email"
      name="email"
      type="email"
      required
      placeholder={t.waitlist.placeholder}
      aria-label={t.common.emailLabel}
      autocomplete="email"
    />
    <button type="submit">{t.waitlist.button}</button>
  </form>

  <p class="form-meta">{t.waitlist.privacy}</p>
  <p class="form-meta">{t.waitlist.fallback}</p>
  <p class="form-success" data-success role="status" aria-live="polite" hidden>
    {t.waitlist.success}
  </p>

  <script is:inline define:vars={{ subject }}>
    const form = document.querySelector('[data-waitlist-form]');
    const success = document.querySelector('[data-success]');
    if (form && success) {
      form.addEventListener('submit', (event) => {
        event.preventDefault();
        const input = form.querySelector('input[name="email"]');
        const email = input?.value?.trim();
        if (!email) return;

        success.hidden = false;
        const encodedSubject = encodeURIComponent(subject);
        const body = encodeURIComponent(`Email: ${email}`);
        window.location.href = `mailto:hello@flowthemoment.com?subject=${encodedSubject}&body=${body}`;
        form.reset();
      });
    }
  </script>
</section>
