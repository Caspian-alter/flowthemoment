---
import { getCopy } from '../i18n/copy';
import { pathFor, stripBase, type Locale, withBase } from '../i18n/utils';
import LanguageSwitcher from './LanguageSwitcher.astro';

interface Props {
  locale: Locale;
  pathname: string;
}

const { locale, pathname } = Astro.props;
const t = getCopy(locale);
const currentPath = stripBase(pathname);

const links = [
  { href: withBase(pathFor(locale, 'home')), label: t.nav.home, internal: pathFor(locale, 'home') },
  { href: withBase(pathFor(locale, 'apps')), label: t.nav.apps, internal: pathFor(locale, 'apps') },
  { href: withBase(pathFor(locale, 'about')), label: t.nav.about, internal: pathFor(locale, 'about') },
  { href: withBase(pathFor(locale, 'blog')), label: t.nav.blog, internal: pathFor(locale, 'blog') },
  { href: withBase(pathFor(locale, 'privacy')), label: t.nav.privacy, internal: pathFor(locale, 'privacy') }
];

function activeFor(link: string): boolean {
  const normalizedPath = currentPath.endsWith('/') && currentPath !== '/' ? currentPath.slice(0, -1) : currentPath;
  const normalizedLink = link.endsWith('/') && link !== '/' ? link.slice(0, -1) : link;
  return normalizedPath === normalizedLink;
}
---

<header class="site-header">
  <div class="shell nav-shell">
    <a href={withBase(pathFor(locale, 'home'))} class="brand-mark">
      <span aria-hidden="true">~</span>
      <strong>Flow the Moment</strong>
    </a>
    <nav aria-label={t.common.navLabel}>
      <ul>
        {links.map((link) => (
          <li>
            <a href={link.href} aria-current={activeFor(link.internal) ? 'page' : undefined}>{link.label}</a>
          </li>
        ))}
      </ul>
    </nav>
    <LanguageSwitcher locale={locale} pathname={pathname} />
  </div>
</header>
